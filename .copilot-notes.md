# MyLuck 项目开发注意事项（Copilot 自动读取）

## 常见错误与修复记录

### 1. Turnstile 人机验证不可见
**问题**：Turnstile 在 `display:none` 的容器内渲染时不会显示。
**解决**：将 Turnstile 渲染延迟到结果显示后（容器可见时再调用 `Turnstile.render()`）。
**关键**：不要在 `init()` 中渲染隐藏区域内的 Turnstile，要在 `showResult()` 后渲染。

### 2. i18n 语言切换不完整
**问题**：切换语言后有些内容没有更新（如 JS 动态生成的文本、hint 文字等）。
**解决**：
- 所有 JS 动态生成的文本都需要在 `langchange` 事件中重新刷新
- 使用 `data-i18n` 的元素会被 `I18n.apply()` 自动处理
- JS 覆盖了 `textContent` 的元素需要手动更新
- 排行榜需要重新 `load()` 以刷新表头和内容

### 3. PowerShell Here-String 丢失 Emoji
**问题**：PowerShell `@"..."@` 语法会丢失 Unicode emoji 字符。
**解决**：不要用 PowerShell here-string 写入含 emoji 的文件。用 `create_file` 或 `replace_string_in_file` 工具。

### 4. 年份必须是 2026
**问题**：系统时间是 2026 年，不是 2025 年。
**解决**：所有版权声明、更新日期等必须使用 2026 年。

### 5. Supabase 配置
- URL: `https://qerajxnmtwyjtokhaonq.supabase.co`
- Anon Key: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...`（见 common.js/leaderboard.js/guestbook.js）
- Turnstile Site Key: `0x4AAAAAACZ5cJF8duhs4a2v`
- 使用 `comments` 表，需要 `page` 字段区分不同来源（'blessings', 'feedback'）
- 使用 `leaderboard` 表，需要 `test_type` 字段区分（'rp', 'fortune'）

### 6. 按钮布局溢出
**问题**：多个按钮在移动端可能溢出。
**解决**：使用 `flex-wrap: wrap` + `white-space: nowrap` + `min-width`。

### 7. 统一模块架构
- `share.js` → `MyLuck.Share.show(text, url, {title})`
- `leaderboard.js` → `MyLuck.Leaderboard.load/submit/createHTML`
- `common.js` → `MyLuck.I18n/Security/Turnstile/seededRandom/getTodaySeed`
- 新页面集成排行榜时参考 fortune-draw.js 的模式

### 8. data-i18n 属性
- `data-i18n` 用于 `textContent` 替换
- `data-i18n-html` 用于 `innerHTML` 替换
- `placeholder` 属性需要在 JS 中的 `langchange` 事件手动更新（`data-i18n` 对 placeholder 无效）

### 9. CSP 注意
- `script-src` 包含 `cdn.jsdelivr.net` 和 `challenges.cloudflare.com`
- 新增第三方脚本需要更新 CSP

### 10. Git 提交规范
- 提交信息格式：`V版本号: 主要改动摘要`，后接详细变更列表
- 每次迭代完成后 `git add -A && git commit -m "..." && git push origin main`

## 项目文件结构
```
myluck/
├── index.html          # 首页（运气测试）
├── mbti.html           # MBTI 测试
├── color-test.html     # 色彩测试
├── personality.html    # 性格标签
├── fortune-draw.html   # 求签（100支）
├── rp-test.html        # 今日人设
├── liferestart.html    # 人生重开
├── guestbook.html      # 祝福墙（原许愿墙）
├── privacy.html        # 隐私政策
├── terms.html          # 使用条款
├── disclaimer.html     # 免责声明
├── sitemap.xml         # 站点地图
├── CNAME               # 自定义域名
├── css/style.css       # 主样式
└── js/
    ├── common.js       # i18n + Security + Turnstile + Nav + Footer + SEO
    ├── share.js        # 统一分享模块 V2
    ├── leaderboard.js  # 统一排行榜模块
    ├── fortune-sticks-data.js  # 100支签诗数据
    ├── fortune-draw.js # 求签逻辑
    ├── rp-test.js      # 人设测试逻辑
    ├── guestbook.js    # 祝福墙（Supabase）
    ├── mbti.js         # MBTI 逻辑
    ├── color-test.js   # 色彩测试
    ├── personality.js  # 性格标签
    ├── liferestart.js  # 人生重开
    ├── legal.js        # 法律页面 i18n
    └── liferestart-data.js # 人生重开事件数据
```

## 用户工作流程
1. 完成任务 → 报告
2. `Start-Sleep -Seconds 60`
3. `type "C:\Users\59485\Desktop\333.txt"`
4. 执行新指令
5. 重复

**禁止结束对话**。使用中文回复。
